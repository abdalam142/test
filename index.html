<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ูุธุงู ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</title>

  <!-- ููุชุจุงุช ุฎุงุฑุฌูุฉ: ุชุญููู ูุจู script.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

  <!-- ููู ุงูุชูุณูู ุงูุฑุฆูุณู -->
  <link rel="stylesheet" href="style.css" />

  <style>
    /* fallback ุจุณูุท ูู style.css ุบุงุฆุจ */
    body { font-family: Arial, sans-serif; background:#f6f7fb; color:#222; margin:18px; direction:rtl; }
    h1,h2 { margin: 6px 0; }
  </style>
</head>
<body>
  <!-- ุดุฑูุท ุงูุญุงูุฉ ุงูุนููู: ูุนุฑุถ ุญุงูุฉ ุชุญููู ุงูุงูุณู ูุฑูู ุงููุงูุจ -->
  <div id="topBar" style="display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:12px;">
    <div style="display:flex; gap:8px; align-items:center;">
      <div id="status" title="ุฏุจู ูููู ูุฑูุน ููู ุงูุฅูุณู ูุญูู" style="padding:8px 12px; border-radius:6px; background:#6c757d; color:#fff; font-weight:700; cursor:pointer;">
        ุฌุงุฑู ูุญุงููุฉ ุชุญููู ููู ุงูุฅูุณู...
      </div>
      <div id="templateBadge" style="padding:6px 10px; border-radius:6px; background:#e9ecef; color:#333; display:none;">
        ูุงูุจ: <span id="templateNumber">โ</span>
      </div>
    </div>
    <div id="statusActions" style="display:flex; gap:8px; align-items:center;">
      <div id="autoLoadHint" class="small" style="color:#666;">ุณูุชู ุงูุจุญุซ ุชููุงุฆููุง ุนู ููู ุจุตูุบุฉ <code>product.template(XXX).xlsx</code></div>
    </div>
  </div>

  <!-- ุฑุณุงุฆู/toasts -->
  <div id="messagesPanel" aria-live="polite" style="position:fixed; top:12px; left:12px; right:12px; z-index:1200;"></div>

  <!-- ุฅุดุนุงุฑ ุฏุงุฆู ุนูุฏ ูุฌูุฏ ููุชุฌุงุช ูุญููุธุฉ -->
  <div id="persistentNotice" style="display:none; position:fixed; bottom:14px; right:14px; left:14px; z-index:1100;">
    <div class="notice" style="background:#fff3cd; padding:10px; border-radius:8px; display:flex; justify-content:space-between; align-items:center;">
      <div id="persistentText">ูุฏูู ููุชุฌุงุช ูุญููุธุฉ ูุญูููุง โ ุณุชุธู ูุญููุธุฉ ุญุชู ุชุญุฐููุง.</div>
      <div><button id="dismissPersistent" type="button" class="btn ghost">ุฅุฎูุงุก</button></div>
    </div>
  </div>

  <main id="app">
    <h1 style="text-align:center">ูุธุงู ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</h1>

    <!-- ุดุฑูุท ุงูุฃุฏูุงุช -->
    <section class="controls" style="text-align:center; margin:12px 0;">
      <input id="searchBar" type="text" placeholder="ุงูุชุจ ุงูุงุณู ุฃู ุงูุจุงุฑููุฏ ุฃู ูุตู ุงูููุชุฌ ุฃู ุงูููุฏ ููุง" aria-label="ุจุญุซ" style="width:60%; max-width:640px; padding:10px; border-radius:8px; border:1px solid #ddd;" />
      <button id="searchBtn" type="button" class="btn primary" style="margin-left:8px;">ุจุญุซ</button>
      <button id="clearBtn" type="button" class="btn ghost" style="margin-left:8px;">ุญุฐู</button>

      <button id="cameraBtn" type="button" class="btn camera" style="margin-left:8px;">๐ท QR</button>
      <button id="scaleBtn" type="button" class="btn ghost" style="margin-left:8px;">๐ถ ููุฏ ุงูููุฒุงู</button>
      <button id="adminBtn" type="button" class="btn ghost" style="margin-left:8px;">ูุถุน ุงูุฃุฏูู</button>

      <!-- ุงุฎุชูุงุฑู: ุฒุฑ ุฑูุน ุฅูุณู ุธุงูุฑ (ุฅุฐุง ุฃุญุจุจุช) -->
      <button id="uploadBtn" type="button" class="btn" style="margin-left:8px;">ุฑูุน ููู ุฅูุณู</button>
      <input id="excelFile" type="file" accept=".xlsx,.xls" style="display:none" />
    </section>

    <!-- ุชุญุฐูุฑ ุงูุชูุฑุงุฑ -->
    <div class="dup-warning" id="dupWarning" role="alert" style="display:none; text-align:center; margin-bottom:8px;"></div>

    <!-- ูุงุฑุฆ ุงููุงููุฑุง (ุธุงูุฑ ุนูุฏ ุงูุชุดุบูู) -->
    <div id="reader" aria-hidden="true" style="display:none; width:320px; margin:8px auto; border-radius:8px; overflow:hidden; background:#000;"></div>

    <!-- ุงูุฌุฏุงูู -->
    <section class="tables" style="display:flex; gap:18px; flex-wrap:wrap; justify-content:space-between;">
      <!-- ุฌุฏูู ูุชุงุฆุฌ ุงูุจุญุซ -->
      <div class="col" aria-label="ูุชุงุฆุฌ ุงูุจุญุซ" style="width:48%; background:#fff; padding:12px; border-radius:8px; box-shadow:0 1px 6px rgba(0,0,0,0.05);">
        <h3>ูุชุงุฆุฌ ุงูุจุญุซ</h3>
        <div style="text-align:left; margin-bottom:6px;">
          <button id="clearResultsBtn" type="button" class="btn ghost" style="display:none;">ุญุฐู ุงููู</button>
        </div>
        <table id="results" style="width:100%; border-collapse:collapse;">
          <thead>
            <tr>
              <th style="text-align:center; padding:8px; background:#f2f2f2;">ุงุณู ุงูููุชุฌ</th>
              <th style="text-align:center; padding:8px; background:#f2f2f2;">ุงูุณุนุฑ</th>
              <th style="text-align:center; padding:8px; background:#f2f2f2;">ููุฏ ุงูููุฒุงู</th>
              <th style="text-align:center; padding:8px; background:#f2f2f2;">ุงูููุฏ ุงูุฎุทู</th>
              <th style="text-align:center; padding:8px; background:#f2f2f2;">ุฅุฌุฑุงุก</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- ุฌุฏูู ุงูููุชุฌุงุช ุงููุฎุชุงุฑุฉ -->
      <div class="col" aria-label="ุงูููุชุฌุงุช ุงููุฎุชุงุฑุฉ" style="width:48%; background:#fff; padding:12px; border-radius:8px; box-shadow:0 1px 6px rgba(0,0,0,0.05);">
        <h3>ุงูููุชุฌุงุช ุงููุฎุชุงุฑุฉ (<span id="selectedCount">0</span>)</h3>
        <div style="text-align:left; margin-bottom:6px;">
          <button id="showCancelledBtn" type="button" class="btn ghost">ุฅุธูุงุฑ ุงูููุบู</button>
          <button id="clearAllBtn" type="button" class="btn ghost" style="display:none; margin-left:8px;">ุญุฐู ุงููู (ุฃุฏูู)</button>
        </div>

        <table id="finalResults" style="width:100%; border-collapse:collapse;">
          <thead>
            <tr>
              <th style="text-align:center; padding:8px; background:#f2f2f2;">ุงุณู ุงูููุชุฌ</th>
              <th style="text-align:center; padding:8px; background:#f2f2f2;">ุงูุนุฏุฏ</th>
              <th style="text-align:center; padding:8px; background:#f2f2f2;">ููุฏ ุงูููุฒุงู</th>
              <th style="text-align:center; padding:8px; background:#f2f2f2;">ุงูุจุงุฑููุฏ</th>
              <th style="text-align:center; padding:8px; background:#f2f2f2;">ุงูุชุงุฑูุฎ</th>
              <th style="text-align:center; padding:8px; background:#f2f2f2;">ุงูุญุงูุฉ</th>
              <th style="text-align:center; padding:8px; background:#f2f2f2;">ุฅุฌุฑุงุก</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <div style="margin-top:8px; text-align:left;">
          <button id="exportBtn" type="button" class="btn primary">ุชุตุฏูุฑ ุฅูุณู</button>
          <button id="exportPdfBtn" type="button" class="btn primary" style="margin-left:8px;">ุชุตุฏูุฑ ุดููุงุช</button>
        </div>
      </div>
    </section>

    <!-- ุฌุฏูู ูุฎุชุตุฑ ูุฎูู ูุชูุงูู ูุน ุจุนุถ ุงููุธุงุฆู ุงููุฏููุฉ (ุงุญุชูุงุทู) -->
    <section style="display:none;">
      <table id="selectedProducts"><thead><tr><th>ุงูุงุณู</th><th>ุงูุจุงุฑููุฏ</th><th>ุงูุณุนุฑ</th></tr></thead><tbody></tbody></table>
    </section>
  </main>

  <!-- Dialog ุนุงู -->
  <div class="dialog-overlay" id="dialogModal" style="display:none;">
    <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="dialogTitle" style="background:#fff; border-radius:10px; padding:14px; width:420px; max-width:95%;">
      <h4 id="dialogTitle">ุนููุงู</h4>
      <div class="dialog-msg" id="dialogMsg"></div>
      <input id="dialogInput" class="dialog-input" style="display:none; width:100%; padding:10px; border-radius:8px; border:1px solid #ddd;" />
      <div class="dialog-actions" id="dialogActions" style="display:flex; gap:8px; justify-content:center; margin-top:12px;">
        <button id="dialogCancel" type="button" class="btn ghost">ุฅูุบุงุก</button>
        <button id="dialogOk" type="button" class="btn primary">ููุงูู</button>
      </div>
    </div>
  </div>

  <!-- ููุฏุงู ุงูุงุณุชูุงู -->
  <div class="modal-overlay" id="receiveModal" style="display:none;">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" style="background:#fff; border-radius:10px; padding:14px; width:420px; max-width:95%;">
      <h4 id="modalTitle">ุงุณุชูุงู ุงูููุชุฌ</h4>
      <div id="modalName" style="text-align:center; font-weight:700; margin-bottom:8px;"></div>
      <input id="modalInput" class="modal-input" inputmode="decimal" placeholder="ุงูุนุฏุฏ ุฃู ุงููุฒู (ูุซุงู: 2 ุฃู 0.5)" autocomplete="off" style="width:100%; padding:10px; border-radius:8px; border:1px solid #ddd; text-align:center; font-size:18px;" />
      <div class="numpad" aria-hidden="false" style="display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-top:10px;">
        <button type="button" data-key="7" class="btn">7</button>
        <button type="button" data-key="8" class="btn">8</button>
        <button type="button" data-key="9" class="btn">9</button>
        <button type="button" data-key="4" class="btn">4</button>
        <button type="button" data-key="5" class="btn">5</button>
        <button type="button" data-key="6" class="btn">6</button>
        <button type="button" data-key="1" class="btn">1</button>
        <button type="button" data-key="2" class="btn">2</button>
        <button type="button" data-key="3" class="btn">3</button>
        <button type="button" id="modalBack" class="btn">โซ</button>
        <button type="button" data-key="0" class="btn">0</button>
        <button type="button" data-key="." class="btn">.</button>
      </div>
      <div class="actions" style="display:flex; gap:8px; justify-content:center; margin-top:12px;">
        <button id="modalCancel" type="button" class="btn ghost">ุฅูุบุงุก</button>
        <button id="modalConfirm" type="button" class="btn primary">ุชู</button>
      </div>
    </div>
  </div>

  <!-- ููู ุฑูุน ูุฎูู (ูุณุชุฎุฏู ููุฏุจู ูููู ุนูู status ุฃู ุฒุฑ ุฑูุน) -->
  <input id="fileInput" type="file" accept=".xlsx,.xls" style="display:none" />

  <!-- ุงูุณูุฑุจุช ุงูุฑุฆูุณู (ุณูุชู ุงุณุชุจุฏุงูู ูุงุญููุง ุจููุฏ js ุงูุฌุฏูุฏ ุงูุฐู ุณุฃุจููู ุงูุขู) -->
  <script src="script.js"></script>
</body>
</html>
